"use strict";(self.webpackChunkfrontend_notes=self.webpackChunkfrontend_notes||[]).push([[3108],{9401:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>x,frontMatter:()=>s,metadata:()=>c,toc:()=>i});var t=n(4848),o=n(8453);const s={},a="\u524d\u7aef\u5bfc\u51fa\u548c\u8bfb\u53d6 excel",c={id:"javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel",title:"\u524d\u7aef\u5bfc\u51fa\u548c\u8bfb\u53d6 excel",description:"\u5b89\u88c5\u4f9d\u8d56 excel.js \u548c file-saver.js",source:"@site/docs/javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel.md",sourceDirName:"javascript\u76f8\u5173",slug:"/javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel",permalink:"/docs/javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"webSorket",permalink:"/docs/javascript\u76f8\u5173/webSorket"},next:{title:"\u5c01\u88c5 axios",permalink:"/docs/javascript\u76f8\u5173/\u5c01\u88c5axios"}},l={},i=[];function d(e){const r={blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"\u524d\u7aef\u5bfc\u51fa\u548c\u8bfb\u53d6-excel",children:"\u524d\u7aef\u5bfc\u51fa\u548c\u8bfb\u53d6 excel"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\u5b89\u88c5\u4f9d\u8d56 excel.js \u548c file-saver.js"}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:"npm install exceljs file-saver --save"})}),"\n",(0,t.jsxs)(r.blockquote,{children:["\n",(0,t.jsx)(r.p,{children:"\u5c01\u88c5 excel \u6784\u9020\u7c7b"}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-js",children:'/**\r\n * ExceljsInstance \u7c7b\u7528\u4e8e\u5904\u7406 Excel \u6587\u4ef6\u7684\u8bfb\u53d6\u548c\u4e0b\u8f7d\u64cd\u4f5c\u3002\r\n */\r\nclass ExceljsInstance {\r\n  /**\r\n   * \u521d\u59cb\u5316 ExceljsInstance \u5b9e\u4f8b\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Excel \u5de5\u4f5c\u7c3f\u3002\r\n   */\r\n  constructor() {\r\n    this.initExcel();\r\n  }\r\n\r\n  /**\r\n   * \u521d\u59cb\u5316 Excel \u5de5\u4f5c\u7c3f\u3002\r\n   */\r\n  initExcel() {\r\n    this.workbook = new ExcelJS.Workbook();\r\n  }\r\n\r\n  /**\r\n   * \u8bfb\u53d6 Excel \u6587\u4ef6\u5e76\u89e3\u6790\u6307\u5b9a\u5de5\u4f5c\u8868\u7684\u6570\u636e\u3002\r\n   * @param {File} file - \u8981\u8bfb\u53d6\u7684 Excel \u6587\u4ef6\u3002\r\n   * @param {number} [sheetIdx=1] - \u5de5\u4f5c\u8868\u7d22\u5f15\uff0c\u9ed8\u8ba4\u4e3a 1\u3002\r\n   * @returns {Promise<void>} - \u5b8c\u6210\u8bfb\u53d6\u548c\u89e3\u6790\u64cd\u4f5c\u7684 Promise\u3002\r\n   */\r\n  readExcelFile(file, sheetIdx = 1) {\r\n    return new Promise((resolve, reject) => {\r\n      if (!file) {\r\n        return reject(new Error("No file provided."));\r\n      }\r\n\r\n      // \u9a8c\u8bc1\u6587\u4ef6\u7c7b\u578b\r\n      if (\r\n        !file.type.includes(\r\n          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"\r\n        )\r\n      ) {\r\n        return reject(\r\n          new Error("Invalid file type. Only .xlsx files are supported.")\r\n        );\r\n      }\r\n\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        const data = e.target.result;\r\n        this.workbook.xlsx\r\n          .load(data)\r\n          .then((workbook) => {\r\n            if (!workbook.getWorksheet(sheetIdx)) {\r\n              return reject(\r\n                new Error(`Sheet index ${sheetIdx} does not exist.`)\r\n              );\r\n            }\r\n\r\n            const worksheet = workbook.getWorksheet(sheetIdx);\r\n            const header = worksheet.getRow(1);\r\n            const headerValues = ["empt", "supplier", "endingPayable"]; // \u8003\u8651\u4ece\u914d\u7f6e\u83b7\u53d6\r\n            const rows = worksheet.getSheetValues();\r\n\r\n            /**\r\n             * \u5c06\u5de5\u4f5c\u8868\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u5bf9\u8c61\u6570\u7ec4\u3002\r\n             * @type {Array<object>}\r\n             */\r\n            const rowsTable = rows.map((row) => {\r\n              const rowObj = {};\r\n              row.forEach((item, index) => {\r\n                if (index === 0) {\r\n                  item = item.trim();\r\n                }\r\n                rowObj[headerValues[index]] = item;\r\n              });\r\n              return rowObj;\r\n            });\r\n\r\n            this.excelData = rowsTable;\r\n            resolve();\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      };\r\n\r\n      reader.onerror = (error) => {\r\n        reject(new Error("Failed to read file."));\r\n      };\r\n\r\n      reader.readAsArrayBuffer(file);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * \u4e0b\u8f7d Excel \u6587\u4ef6\u3002\r\n   * @param {Array} columns - \u5217\u5b9a\u4e49\u6570\u7ec4\u3002\r\n   * @param {Array} tableData - \u8868\u683c\u6570\u636e\u6570\u7ec4\u3002\r\n   * @param {string} fileName - \u4e0b\u8f7d\u7684\u6587\u4ef6\u540d\u3002\r\n   */\r\n  async downloadExcel(columns, tableData, fileName) {\r\n    try {\r\n      const worksheet = this.workbook.addWorksheet("Sheet1");\r\n      worksheet.columns = columns;\r\n      worksheet.addTable({\r\n        ref: "A1",\r\n        columns: columns,\r\n        rows: tableData.map((item) => Object.values(item)),\r\n      });\r\n\r\n      const buffer = await workbook.xlsx.writeBuffer();\r\n      saveAs(new Blob([buffer]), `${fileName}.xlsx`);\r\n    } catch (error) {\r\n      console.log("Download failed:", error);\r\n      // \u53ef\u4ee5\u8003\u8651\u66f4\u4f18\u96c5\u7684\u9519\u8bef\u5904\u7406\u65b9\u5f0f\uff0c\u5982\u7528\u6237\u901a\u77e5\u6216\u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\r\n    }\r\n  }\r\n}\r\n\r\nexport default ExceljsInstance;\n'})})]})}function x(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>c});var t=n(6540);const o={},s=t.createContext(o);function a(e){const r=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(s.Provider,{value:r},e.children)}}}]);