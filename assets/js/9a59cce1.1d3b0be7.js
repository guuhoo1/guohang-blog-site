"use strict";(self.webpackChunkfrontend_notes=self.webpackChunkfrontend_notes||[]).push([[9787],{8540:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var t=r(4848),s=r(8453);const o={},c="\u5c01\u88c5 axios",i={id:"javascript\u76f8\u5173/\u5c01\u88c5axios",title:"\u5c01\u88c5 axios",description:"\u4e0b\u8f7d axios \u4f9d\u8d56",source:"@site/docs/javascript\u76f8\u5173/\u5c01\u88c5axios.md",sourceDirName:"javascript\u76f8\u5173",slug:"/javascript\u76f8\u5173/\u5c01\u88c5axios",permalink:"/docs/javascript\u76f8\u5173/\u5c01\u88c5axios",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/javascript\u76f8\u5173/\u5c01\u88c5axios.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u524d\u7aef\u5bfc\u51fa\u548c\u8bfb\u53d6 excel",permalink:"/docs/javascript\u76f8\u5173/\u524d\u7aef\u5bfc\u51faExcel"},next:{title:"\u5faa\u73af",permalink:"/docs/javascript\u76f8\u5173/\u5faa\u73af"}},a={},u=[];function d(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"\u5c01\u88c5-axios",children:"\u5c01\u88c5 axios"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"\u4e0b\u8f7d axios \u4f9d\u8d56"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.code,{children:"npm install axios -S"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"CancelToken.js"}),"\n"]}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map",children:"ES6 Map \u76f8\u5173\u77e5\u8bc6"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:"// \u7d00\u9304\u8acb\u6c42\u4e2d API\r\nexport const pendingRequests = new Map();\r\n\r\nexport function removeRequestPending(config) {\r\n  const uuid = generateUUID(config); // \u4fdd\u6301\u751f\u6210UUID\u7684\u903b\u8f91\u4e0d\u53d8\r\n  const item = pendingRequests.get(uuid);\r\n  if (item) {\r\n    item.cancel();\r\n    pendingRequests.delete(uuid);\r\n  }\r\n}\r\n\r\n// \u4f18\u5316\u540e\u7684\u53d6\u6d88\u6240\u6709\u8bf7\u6c42\u7684\u51fd\u6570\r\nexport function cancelAllPending() {\r\n  for (const item of pendingRequests.values()) {\r\n    item.cancel();\r\n  }\r\n  pendingRequests.clear();\r\n}\r\n\r\n// \u4f18\u5316\u540e\u7684\u6e05\u9664\u7279\u5b9a\u8bf7\u6c42\u7684\u51fd\u6570\r\nexport function clearRequestPending(config) {\r\n  const uuid = generateUUID(config); // \u4fdd\u6301\u751f\u6210UUID\u7684\u903b\u8f91\u4e0d\u53d8\r\n  pendingRequests.delete(uuid);\r\n}\r\n\r\n// \u4f18\u5316\u540e\u7684\u6dfb\u52a0\u8bf7\u6c42\u5230\u7ba1\u7406\u5668\u7684\u51fd\u6570\r\nexport function addRequestPending(item) {\r\n  pendingRequests.set(item.uuid, item);\r\n}\r\n\r\n// \u8f85\u52a9\u51fd\u6570\uff0c\u751f\u6210\u7528\u4e8e\u8bc6\u522b\u8bf7\u6c42\u7684UUID\r\nexport function generateUUID(config) {\r\n  return `${config.url}&${config.method}${JSON.stringify(config.data)}`;\r\n}\n"})}),"\n",(0,t.jsxs)(e.blockquote,{children:["\n",(0,t.jsx)(e.p,{children:"index.js"}),"\n"]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-js",children:'import axios from "axios";\r\nimport {\r\n  removeRequestPending,\r\n  addRequestPending,\r\n  clearRequestPending,\r\n  generateUUID\r\n} from "./CancelToken";\r\n\r\nconst defaultConfig = {\r\n  timeOut: 50000,\r\n  baseURL: import.meta.env.VITE_BASE_URL\r\n    ? import.meta.env.VITE_BASE_URL\r\n    : "http://110.42.184.111",\r\n};\r\n\r\nconst Cancel = axios.CancelToken;\r\n\r\nconst axiosInstance = axios.create(defaultConfig);\r\n\r\n// \u8acb\u6c42\u6514\u622a\r\naxiosInstance.interceptors.request.use(\r\n  (config) => {\r\n    console.log("\u8acb\u6c42\u6514\u622a\u6e2c\u8a66");\r\n    removeRequestPending(config);\r\n\r\n    config.cancelToken = new Cancel((cancel) => {\r\n      const requestItem = {\r\n        uuid: generateUUID(config)\r\n        cancel,\r\n      };\r\n      addRequestPending(config);\r\n    });\r\n\r\n    return config;\r\n  },\r\n  (err) => {\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\n// \u56de\u61c9\u6514\u622a\r\naxiosInstance.interceptors.response.use(\r\n  (res) => {\r\n    console.log("\u56de\u61c9\u6514\u622a\u6e2c\u8a66");\r\n    clearRequestPending(res.config);\r\n\r\n    return res;\r\n  },\r\n  (err) => {\r\n    clearRequestPending(err.config);\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n\r\nexport const httpRequestGet = (url, params) => {\r\n  return axiosInstance\r\n    .get(url, params)\r\n    .then((res) => res.data)\r\n    .catch();\r\n};\r\n\r\nexport const httpRequestPost = (url, params) => {\r\n  return axiosInstance\r\n    .post(url, params)\r\n    .then((res) => res.data)\r\n    .catch();\r\n};\n'})})]})}function l(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>c,x:()=>i});var t=r(6540);const s={},o=t.createContext(s);function c(n){const e=t.useContext(o);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);