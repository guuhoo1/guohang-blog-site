"use strict";(self.webpackChunkfrontend_notes=self.webpackChunkfrontend_notes||[]).push([[6243],{1926:(r,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>h});var n=t(4848),s=t(8453);const i={},a=void 0,o={id:"javascript\u76f8\u5173/XHR",title:"XHR",description:"\u4ecb\u7ecd XHR",source:"@site/docs/javascript\u76f8\u5173/XHR.md",sourceDirName:"javascript\u76f8\u5173",slug:"/javascript\u76f8\u5173/XHR",permalink:"/docs/javascript\u76f8\u5173/XHR",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/javascript\u76f8\u5173/XHR.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ES6 Promise",permalink:"/docs/javascript\u76f8\u5173/PromiseAndAsyncAwait"},next:{title:"input\u4e0a\u4f20",permalink:"/docs/javascript\u76f8\u5173/input\u4e0a\u4f20"}},c={},h=[{value:"\u4ecb\u7ecd XHR",id:"\u4ecb\u7ecd-xhr",level:3},{value:"\u5c01\u88c5 XHR \u7c7b\u65b9\u6cd5",id:"\u5c01\u88c5-xhr-\u7c7b\u65b9\u6cd5",level:4}];function u(r){const e={code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,s.R)(),...r.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h3,{id:"\u4ecb\u7ecd-xhr",children:"\u4ecb\u7ecd XHR"}),"\n",(0,n.jsx)(e.p,{children:"XHR \u662f XMLHttpRequest \u7684\u7b80\u79f0\uff0c\u662f\u6d4f\u89c8\u5668\u63d0\u4f9b\u7684\u4e00\u4e2a\u5bf9\u8c61\uff0c\u7528\u4e8e\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\uff0c\u83b7\u53d6\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\u3002"}),"\n",(0,n.jsx)(e.h4,{id:"\u5c01\u88c5-xhr-\u7c7b\u65b9\u6cd5",children:"\u5c01\u88c5 XHR \u7c7b\u65b9\u6cd5"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-js",children:"// xhr\u5c01\u88c5\u8bf7\u6c42\u65b9\u6cd5\r\n\r\n/**\r\n * \u8868\u793a\u4e00\u4e2aXMLHttpRequest\u5b9e\u4f8b\uff0c\u5c01\u88c5\u4e86\u53d1\u9001XMLHttpRequest\u7684\u529f\u80fd\u3002\r\n */\r\nclass XhrRequestInstance {\r\n  /**\r\n   * \u6784\u9020\u4e00\u4e2aXMLHttpRequest\u5b9e\u4f8b\u3002\r\n   * @param {Object} config - \u914d\u7f6e\u5bf9\u8c61\uff0c\u5305\u542burl\u3001method\u548ctimeout\u5c5e\u6027\u3002\r\n   */\r\n  constructor(config) {\r\n    this.xhr = new XMLHttpRequest()\r\n    this.url = config.url\r\n    this.method = config.method || 'GET'\r\n    this.timeout = config.timeout || 5000\r\n    this.timer = null\r\n  }\r\n\r\n  /**\r\n   * \u5c06\u53c2\u6570\u5bf9\u8c61\u8f6c\u6362\u4e3aURL\u67e5\u8be2\u5b57\u7b26\u4e32\u683c\u5f0f\u3002\r\n   * @param {Object} params - \u8981\u8f6c\u6362\u7684\u53c2\u6570\u5bf9\u8c61\u3002\r\n   * @returns {String} \u8f6c\u6362\u540e\u7684URL\u67e5\u8be2\u5b57\u7b26\u4e32\u3002\r\n   */\r\n  getParams(params) {\r\n    return Object.entries(params)\r\n      .map(item => {\r\n        return `${item[0]}=${item[1]}`\r\n      })\r\n      .join('')\r\n  }\r\n\r\n  /**\r\n   * \u53d1\u9001\u4e00\u4e2aXMLHttpRequest\u3002\r\n   * @param {Object} params - \u8bf7\u6c42\u53c2\u6570\uff08\u5982\u679c\u6709\uff09\u3002\r\n   * @returns {Promise} \u8fd4\u56de\u4e00\u4e2aPromise\u5bf9\u8c61\uff0c\u6210\u529f\u65f6\u89e3\u6790\u54cd\u5e94\uff0c\u5931\u8d25\u65f6\u62d2\u7edd\u9519\u8bef\u4fe1\u606f\u3002\r\n   */\r\n  request(params = {}) {\r\n    return new Promise((resolve, reject) => {\r\n      clearTimeout(this.timer)\r\n      this.timer = setTimeout(() => {\r\n        this.xhr.abort()\r\n        reject('\u8bf7\u6c42\u8d85\u65f6')\r\n      }, this.timeout)\r\n\r\n      if (this.method === 'GET') {\r\n        params = this.getParams(params)\r\n        this.xhr.open(this.method, `${this.url}${params ? `?${params}` : ''}`)\r\n      } else {\r\n        this.xhr.setRequestHeader('Content-Type', 'application/json')\r\n        this.xhr.open(this.method, this.url)\r\n        params = JSON.stringify(params)\r\n      }\r\n\r\n      this.xhr.onload = () => {\r\n        if (this.xhr.status === 200) {\r\n          clearTimeout(this.timer)\r\n          resolve(this.xhr.response)\r\n        } else {\r\n          clearTimeout(this.timer)\r\n          reject(this.xhr.response)\r\n        }\r\n      }\r\n\r\n      this.xhr.onerror = () => {\r\n        reject(this.xhr.response)\r\n      }\r\n\r\n      this.xhr.send(this.method === 'POST' && params)\r\n    })\r\n  }\r\n}\r\n\r\nexport default XhrRequestInstance\n"})})]})}function p(r={}){const{wrapper:e}={...(0,s.R)(),...r.components};return e?(0,n.jsx)(e,{...r,children:(0,n.jsx)(u,{...r})}):u(r)}},8453:(r,e,t)=>{t.d(e,{R:()=>a,x:()=>o});var n=t(6540);const s={},i=n.createContext(s);function a(r){const e=n.useContext(i);return n.useMemo((function(){return"function"==typeof r?r(e):{...e,...r}}),[e,r])}function o(r){let e;return e=r.disableParentContext?"function"==typeof r.components?r.components(s):r.components||s:a(r.components),n.createElement(i.Provider,{value:e},r.children)}}}]);